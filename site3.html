<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether: Interactive Career & Study Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <style>
        :root {
            --bg-main: #F4F4F5;
            --bg-alt: #FFFFFF;
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --accent-primary: #DC2626; /* Fusion Red */
            --accent-secondary: #B91C1C;
            --border-color: #E5E7EB;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-primary); }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        /* New Layout Styles */
        #main-app-container { display: flex; }
        #sidebar {
            width: 68px;
            transition: width 0.3s ease;
            z-index: 30;
        }
        #sidebar:hover { width: 240px; }
        .sidebar-item .nav-text {
            display: none;
            transition: opacity 0.2s ease;
        }
        #sidebar:hover .nav-text { display: inline; }
        .sidebar-item.active { background-color: var(--accent-primary); color: white; }
        .sidebar-item.active svg { color: white; }

        .content-section { display: none; }
        .content-section.active { display: block; }

        /* Canvas & Gantt Chart Styles */
        .interactive-canvas { 
            background-color: #F9FAFB; 
            background-image: 
                linear-gradient(var(--border-color) 1px, transparent 1px), 
                linear-gradient(to right, var(--border-color) 1px, #F9FAFB 1px); 
            background-size: 25px 25px;
            cursor: grab;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
        }
        .interactive-canvas.linking-mode { cursor: crosshair; }
        .interactive-canvas:active { cursor: grabbing; }
        
        /* General Component Styles */
        #notes-editor { height: 250px; background-color: white; }
        .flashcard-container { perspective: 1000px; cursor: pointer; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard-container.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 1rem; }
        .flashcard-back { transform: rotateY(180deg); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .drag-drop-zone { border: 2px dashed var(--border-color); border-radius: 0.5rem; padding: 1rem; text-align: center; cursor: pointer; transition: background-color 0.2s; }
        .drag-drop-zone.drag-over { background: #fee2e2; border-color: var(--accent-primary); }
        .required { color: var(--accent-primary); }
        .disclaimer { font-size: 0.8em; color: #555; margin-top: 8px; }
        .timeline-container { max-height: 400px; overflow-y: auto; }
        .timeline-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; object-fit: cover; }
        .toggle-button.active { background-color: var(--accent-primary); color: white; }
        
        /* Toast Notification */
        #toast-notification {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            transition: bottom 0.5s ease-in-out;
            z-index: 100;
        }
        #toast-notification.show {
            bottom: 20px;
        }
        .podcast-tab.active, .community-main-tab.active {
            border-bottom-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        .emoji-btn { transition: transform 0.1s ease-in-out; }
        .emoji-btn:hover { transform: scale(1.2); }
    </style>
</head>
<body class="antialiased">

    <!-- Landing/Registration Page -->
    <div id="registration-page" class="flex items-center justify-center min-h-screen bg-gray-100 p-4">
        <div class="text-center p-8 bg-white rounded-xl shadow-2xl max-w-lg mx-auto w-full">
            <h1 class="text-5xl font-black text-red-600 mb-4">Aether</h1>
            <p class="text-xl text-text-secondary mb-8">Create your profile to begin your integrated career and learning journey.</p>
            <form id="regForm" class="text-left" novalidate>
                 <div class="space-y-4">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name<span class="required">*</span></label>
                        <input type="text" id="fullName" name="fullName" required class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email<span class="required">*</span></label>
                        <input type="email" id="email" name="email" required class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password<span class="required">*</span></label>
                        <input type="password" id="password" name="password" required class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="headline" class="block text-sm font-medium text-gray-700">Headline</label>
                        <input type="text" id="headline" name="headline" placeholder="e.g. Aspiring AI Researcher" class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label for="bioReg" class="block text-sm font-medium text-gray-700">Bio</label>
                        <textarea id="bioReg" name="bioReg" rows="3" placeholder="Tell us about your goals and interests..." class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                    </div>
                    <div>
                        <label for="avatarReg" class="block text-sm font-medium text-gray-700">Avatar URL</label>
                        <input type="url" id="avatarReg" name="avatarReg" placeholder="Link to your photo" class="mt-1 w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                </div>
                <button type="submit" class="mt-6 w-full px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">Create Profile & Enter</button>
                <p class="disclaimer mt-4">By registering, you acknowledge that your data may be used for research purposes to improve career and economic outcomes for students, and will be de-identified before any analysis or publication.</p>
                <div class="text-center mt-4 text-sm text-gray-600">
                    <a href="#" id="show-signin" class="font-medium text-red-600 hover:text-red-500">Already have an account? Sign In</a>
                    <span class="mx-2">|</span>
                    <a href="#" id="show-admin-signin" class="font-medium text-gray-600 hover:text-gray-800">Admin Sign-In</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="main-app-container" class="hidden">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="bg-gray-800 text-gray-300 h-screen sticky top-0 flex flex-col items-center py-4 space-y-4 overflow-hidden">
            <a href="#" class="text-red-500 font-black text-3xl mb-4">√Ü</a>
            <nav id="main-nav" class="flex flex-col space-y-2 w-full">
                <button data-target="dashboard" class="sidebar-item flex items-center py-3 px-5 rounded-md text-left w-full hover:bg-gray-700 active">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    <span class="nav-text ml-4 font-semibold">Dashboard</span>
                </button>
                <button data-target="strategy" class="sidebar-item flex items-center py-3 px-5 rounded-md text-left w-full hover:bg-gray-700">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 10l6-3m0 0V7"></path></svg>
                    <span class="nav-text ml-4 font-semibold">My Strategy</span>
                </button>
                <button data-target="canvas" class="sidebar-item flex items-center py-3 px-5 rounded-md text-left w-full hover:bg-gray-700">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <span class="nav-text ml-4 font-semibold">Career Path</span>
                </button>
                <button data-target="collaboration" class="sidebar-item flex items-center py-3 px-5 rounded-md text-left w-full hover:bg-gray-700">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span class="nav-text ml-4 font-semibold">Strategic Collaboration</span>
                </button>
                <button data-target="admin" id="admin-nav-btn" class="sidebar-item flex items-center py-3 px-5 rounded-md text-left w-full hover:bg-gray-700 hidden">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                    <span class="nav-text ml-4 font-semibold">Admin</span>
                </button>
            </nav>
            <div class="mt-auto w-full">
                 <button data-target="profile" id="profile-nav-btn" class="sidebar-item flex items-center py-3 px-5 text-left w-full hover:bg-gray-700">
                    <img id="nav-avatar" src="https://i.pravatar.cc/32" alt="Profile" class="w-8 h-8 rounded-full flex-shrink-0"/>
                    <span class="nav-text ml-4 font-semibold">Profile</span>
                </button>
                 <button id="sign-out-btn" class="sidebar-item flex items-center py-3 px-5 text-left w-full hover:bg-gray-700">
                    <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span class="nav-text ml-4 font-semibold">Sign Out</span>
                </button>
            </div>
        </aside>

        <div class="flex-1">
            <main class="p-6 sm:p-8">
                <section id="dashboard" class="content-section active">
                    <h1 class="text-3xl font-bold mb-6">Dashboard</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Universal Search -->
                            <div class="bg-white p-6 rounded-xl border shadow-sm">
                                <h2 class="text-xl font-bold mb-4">Universal Search</h2>
                                <div class="flex items-center gap-2">
                                    <input type="search" id="universal-search-bar" placeholder="Search across platforms..." class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 bg-gray-50"/>
                                </div>
                                <div id="search-providers" class="flex flex-wrap items-center gap-2 mt-3">
                                    <button data-provider="google" class="flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-md">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.75 8.36,4.73 12.19,4.73C15.28,4.73 17.27,6.82 17.27,6.82L19.05,5.27C19.05,5.27 16.76,3 12.19,3C6.42,3 2.03,7.27 2.03,12C2.03,16.73 6.42,21 12.19,21C18.08,21 21.54,16.65 21.54,12.24C21.54,11.64 21.48,11.37 21.35,11.1Z" /></svg>
                                        Internet
                                    </button>
                                    <button data-provider="wos" class="flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-md">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18"></path></svg>
                                        Web of Science
                                    </button>
                                    <button data-provider="wikipedia" class="flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-md">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.1,2.9C6.5,2.9,2,7.4,2,13c0,5.6,4.5,10.1,10.1,10.1c5.6,0,10.1-4.5,10.1-10.1C22.2,7.4,17.7,2.9,12.1,2.9z M11,5.9h2v1.5h-2V5.9z M11,8.9h2v8.5h-2V8.9z M5.1,13c0-1,0.2-2,0.5-2.9l1.5,0.9c-0.2,0.6-0.3,1.3-0.3,2c0,0.7,0.1,1.4,0.3,2l-1.5,0.9C5.3,15,5.1,14,5.1,13z M18.1,13c0,1-0.2,2-0.5,2.9l-1.5-0.9c0.2-0.6,0.3-1.3,0.3-2c0-0.7-0.1-1.4-0.3-2l1.5-0.9C17.9,11,18.1,12,18.1,13z"/></svg>
                                        Wikipedia
                                    </button>
                                    <button data-provider="pubmed" class="flex-1 flex items-center justify-center gap-2 px-3 py-2 text-sm font-semibold bg-gray-100 hover:bg-gray-200 rounded-md">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2h1a2 2 0 002-2v-1a2 2 0 012-2h1.945M7.8 19.8l.2-2.8m5.2 2.8l-.2-2.8m-2.2 0l-.2-2.8m-2.2 0l.2-2.8m2.2 0l.2-2.8m2.2 0l-.2-2.8M15 3.2l-3 4-3-4M9 11h6"></path></svg>
                                        PubMed
                                    </button>
                                </div>
                            </div>
                            <!-- Aether Feed -->
                            <div class="bg-white p-6 rounded-xl border shadow-sm">
                                <h2 class="text-xl font-bold mb-4">Aether Feed</h2>
                                <div class="flex items-start gap-3">
                                    <img id="feed-avatar" src="" class="w-10 h-10 rounded-full">
                                    <div class="flex-1">
                                        <textarea id="feed-post-input" class="w-full p-2 border rounded-lg" rows="3" placeholder="What's on your mind?"></textarea>
                                        <div class="flex justify-between items-center mt-2">
                                            <label class="flex items-center text-sm text-gray-600">
                                                <input type="checkbox" id="feed-notify-email" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500 mr-2">
                                                Notify via Email
                                            </label>
                                            <button id="feed-post-btn" class="px-4 py-2 bg-accent-primary text-white font-bold rounded-lg hover:bg-accent-secondary">Post</button>
                                        </div>
                                    </div>
                                </div>
                                <div id="aether-feed-posts" class="mt-6 space-y-4"></div>
                            </div>
                        </div>
                        <!-- Right Column -->
                        <div class="lg:col-span-1 space-y-6">
                             <div class="bg-white p-6 rounded-xl border shadow-sm">
                                <h2 class="text-xl font-bold mb-4">‚è≥ Connections Timeline</h2>
                                <div class="timeline-container">
                                    <ul id="timelineList" class="space-y-3"></ul>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl border shadow-sm">
                                <h2 class="text-xl font-bold mb-4">üéôÔ∏è Podcast Hub</h2>
                                <div class="flex border-b mb-3">
                                    <button class="podcast-tab flex-1 py-2 text-sm font-semibold border-b-2 border-transparent active" data-tab="rss">From RSS</button>
                                    <button class="podcast-tab flex-1 py-2 text-sm font-semibold border-b-2 border-transparent" data-tab="uploads">My Uploads</button>
                                </div>
                                <div id="podcast-rss-content">
                                    <div class="flex gap-2 mb-4">
                                        <input id="feedUrl" type="url" placeholder="Podcast RSS feed..." class="w-full p-2 border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                        <button id="fetchFeed" class="px-3 py-2 bg-accent-primary text-white font-bold rounded-lg hover:bg-accent-secondary flex-shrink-0">Load</button>
                                    </div>
                                    <ul id="episodeFeed" class="space-y-4 max-h-64 overflow-y-auto"></ul>
                                </div>
                                <div id="podcast-uploads-content" class="hidden">
                                    <label for="podcast-upload-input" class="w-full cursor-pointer text-center block bg-gray-100 hover:bg-gray-200 text-sm font-semibold py-2 px-4 rounded-lg">Upload Audio File</label>
                                    <input type="file" id="podcast-upload-input" class="hidden" accept="audio/*">
                                    <ul id="uploaded-episodes" class="space-y-4 max-h-64 overflow-y-auto mt-4"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="strategy" class="content-section"></section>
                <section id="canvas" class="content-section"></section>
                <section id="learning" class="content-section"></section>
                <section id="collaboration" class="content-section"></section>
                <section id="admin" class="content-section"></section>
                <section id="profile" class="content-section"></section>
            </main>
        </div>
    </div>

    <!-- Modals and Notifications -->
    <div id="toast-notification" class="bg-gray-900 text-white text-sm font-semibold py-2 px-4 rounded-full shadow-lg">
        <p id="toast-message"></p>
    </div>
    <div id="profile-search-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
         <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center"><h3 class="text-lg font-bold">AI-Generated Dream Job Profiles</h3><button id="close-search-modal" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button></div>
            <div id="profile-results-content" class="p-6 overflow-y-auto"></div>
        </div>
    </div>
    <div id="signin-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-8">
            <h2 class="text-2xl font-bold text-center mb-6">Sign In</h2>
            <form id="signin-form">
                <div class="space-y-4">
                    <input type="email" id="signin-email" placeholder="Email" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <button type="submit" class="w-full px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700">Sign In</button>
                </div>
            </form>
        </div>
    </div>
    <div id="admin-signin-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-8">
            <h2 class="text-2xl font-bold text-center mb-6">Admin Access</h2>
            <form id="admin-signin-form">
                <div class="space-y-4">
                    <input type="password" id="admin-pin" placeholder="Enter Admin PIN" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <button type="submit" class="w-full px-6 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-900">Authenticate</button>
                </div>
            </form>
        </div>
    </div>
    <div id="add-community-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-bold">Create a New Discussion Channel</h3>
                <button id="close-community-modal" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="new-community-list" class="p-6 overflow-y-auto">
                <!-- Topic repository will be rendered here -->
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const ADMIN_PIN = '373202';

    // --- MOCK DATABASE ---
    const mockDatabase = {
        _data: {
            feedPosts: [],
            projects: [],
            canvasNodes: [
                { id: 'n1', type: 'rock', title: 'Become a Robotics Engineer', x: 50, y: 150 },
                { id: 'n2', type: 'pebble', title: 'Master Python for Robotics', x: 350, y: 50 },
                { id: 'n3', type: 'study', title: 'Complete CS50 Course', x: 350, y: 250 }
            ],
            canvasConnections: [ { from: 'n1', to: 'n2' }, { from: 'n1', to: 'n3' } ],
            ganttTasks: [
                { id: 1, name: 'Initial Research', start: '2025-07-15', end: '2025-07-25', color: '#3B82F6' },
                { id: 2, name: 'Develop Prototype', start: '2025-07-26', end: '2025-08-15', color: '#10B981' }
            ],
            collabPosts: [
                { id: 1, community: 'neuro', user: 'Alex Ray', avatar: 'https://i.pravatar.cc/150?u=alex', text: 'Just read a fascinating paper on optogenetics. The level of precision is incredible!', reactions: {appreciate: 15, learn: 8, understood: 12, questions: 2}, comments: [{user: 'Becca Chan', text: 'Totally agree! The implications for mapping neural circuits are huge.'}] },
                { id: 2, community: 'stats', user: 'Becca Chan', avatar: 'https://i.pravatar.cc/150?u=becca', text: 'Anyone have experience with Bayesian modeling for time-series data? Looking for advice on my thesis.', reactions: {appreciate: 22, learn: 18, understood: 5, questions: 10}, comments: [] },
                { id: 3, community: 'general', user: 'Carlito Rodriguez', avatar: 'https://i.pravatar.cc/150?u=carlito', text: 'Feeling a bit of imposter syndrome today. Any tips for staying motivated during a long Ph.D. program?', reactions: {appreciate: 45, learn: 3, understood: 30, questions: 1}, comments: [{user: 'Alex Ray', text: "You're not alone! Taking regular breaks and celebrating small wins helps me a lot."}]}
            ],
            allRegistrations: [],
            connections: [],
            uploadedEpisodes: []
        },
        init() {
            for (const key in this._data) {
                const storedData = localStorage.getItem(`aether_${key}`);
                if (storedData) {
                    try {
                        this._data[key] = JSON.parse(storedData);
                    } catch (e) {
                        console.error(`Error parsing localStorage for key ${key}:`, e);
                    }
                }
            }
        },
        get(key) {
            return this._data[key] || [];
        },
        set(key, value) {
            this._data[key] = value;
            localStorage.setItem(`aether_${key}`, JSON.stringify(value));
        }
    };
    mockDatabase.init();

    const mainAppContainer = document.getElementById('main-app-container');
    const landingPage = document.getElementById('registration-page');
    
    // --- Page Initialization State ---
    const pageInitialized = {
        dashboard: false, strategy: false, canvas: false, learning: false, collaboration: false, admin: false, profile: false
    };

    // --- Authentication & Initialization ---
    function showApp(userData, isAdmin = false) {
        landingPage.style.display = 'none';
        mainAppContainer.style.display = 'flex';
        initializeMainApp(userData, isAdmin);
    }

    document.getElementById('regForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const regForm = e.target;
        const userData = {
            fullName: regForm.fullName.value, email: regForm.email.value, headline: regForm.headline.value,
            bio: regForm.bioReg.value, avatarUrl: regForm.avatarReg.value || `https://i.pravatar.cc/150?u=${regForm.email.value}`
        };
        localStorage.setItem('aetherCurrentUser', JSON.stringify(userData));
        
        const allRegistrations = mockDatabase.get('allRegistrations');
        // Prevent duplicate registrations
        if (!allRegistrations.some(u => u.email === userData.email)) {
            allRegistrations.push(userData);
            mockDatabase.set('allRegistrations', allRegistrations);
        }

        const connections = mockDatabase.get('connections');
        connections.unshift({ name: userData.fullName, avatarUrl: userData.avatarUrl, connectedAt: new Date().toISOString() });
        mockDatabase.set('connections', connections.slice(0, 100));
        
        showApp(userData);
    });

    document.getElementById('show-signin').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('signin-modal').style.display = 'flex'; });
    document.getElementById('signin-modal').addEventListener('click', (e) => { if (e.target.id === 'signin-modal') e.target.style.display = 'none'; });
    document.getElementById('signin-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const emailToFind = document.getElementById('signin-email').value;
        const allUsers = mockDatabase.get('allRegistrations');
        const foundUser = allUsers.find(user => user.email === emailToFind);

        if (foundUser) {
            localStorage.setItem('aetherCurrentUser', JSON.stringify(foundUser));
            showApp(foundUser);
        } else {
            alert('No account found with that email. Please register.');
        }
    });
    
    document.getElementById('show-admin-signin').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('admin-signin-modal').style.display = 'flex';
    });
    document.getElementById('admin-signin-modal').addEventListener('click', (e) => {
        if (e.target.id === 'admin-signin-modal') e.target.style.display = 'none';
    });
    document.getElementById('admin-signin-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const pin = document.getElementById('admin-pin').value;
        if (pin === ADMIN_PIN) {
            const adminUser = {
                fullName: "Admin",
                email: "admin@aether.com",
                avatarUrl: "https://i.pravatar.cc/150?u=admin"
            };
            localStorage.setItem('aetherCurrentUser', JSON.stringify(adminUser));
            document.getElementById('admin-signin-modal').style.display = 'none';
            showApp(adminUser, true);
        } else {
            alert('Invalid Admin PIN.');
        }
    });


    const storedUser = localStorage.getItem('aetherCurrentUser');
    if (storedUser) {
        showApp(JSON.parse(storedUser));
    } else {
        landingPage.style.display = 'flex';
    }

    // --- Main App Logic ---
    function initializeMainApp(userData, isAdmin = false) {
        document.getElementById('nav-avatar').src = userData.avatarUrl;
        
        const nav = document.getElementById('main-nav');
        const profileNavBtn = document.getElementById('profile-nav-btn');
        const sections = document.querySelectorAll('.content-section');
        
        if(isAdmin) {
            document.getElementById('admin-nav-btn').classList.remove('hidden');
        }

        function navigateTo(targetId) {
            if (!targetId) return;
            nav.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.toggle('active', btn.dataset.target === targetId));
            profileNavBtn.classList.toggle('active', 'profile' === targetId);

            sections.forEach(section => section.classList.toggle('active', section.id === targetId));
            
            if (!pageInitialized[targetId]) {
                const initFunctions = {
                    dashboard: initDashboard,
                    strategy: initStrategyPage,
                    canvas: initCareerMap,
                    learning: initLearningHub,
                    collaboration: initCollaborationPage,
                    admin: initAdminPage,
                    profile: initProfilePage
                };
                if (initFunctions[targetId]) initFunctions[targetId](userData);
                pageInitialized[targetId] = true;
            }
        }

        nav.addEventListener('click', (e) => {
            const button = e.target.closest('button[data-target]');
            if (button) navigateTo(button.dataset.target);
        });
        profileNavBtn.addEventListener('click', () => navigateTo('profile'));

        document.getElementById('sign-out-btn').addEventListener('click', () => {
            localStorage.removeItem('aetherCurrentUser');
            window.location.reload();
        });

        navigateTo('dashboard');
    }

    // --- Toast Notification ---
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast-notification');
        const toastMessage = document.getElementById('toast-message');
        toastMessage.textContent = message;
        
        toast.classList.remove('bg-gray-900', 'bg-blue-600');
        if (type === 'info') {
            toast.classList.add('bg-blue-600');
        } else {
            toast.classList.add('bg-gray-900');
        }

        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // --- SECTION INITIALIZERS ---

    function initDashboard(userData) {
        // Universal Search
        const searchBar = document.getElementById('universal-search-bar');
        document.getElementById('search-providers').addEventListener('click', e => {
            const button = e.target.closest('button[data-provider]');
            if (!button) return;
            
            const provider = button.dataset.provider;
            const query = searchBar.value;
            if (!query) {
                alert("Please enter a search query.");
                return;
            }

            let url;
            switch(provider) {
                case 'google':
                    url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    break;
                case 'wos':
                    url = `https://www.webofscience.com/wos/woscc/basic-search?search_mode=BasicSearchForm&value(input1)=${encodeURIComponent(query)}`;
                    break;
                case 'wikipedia':
                    url = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`;
                    break;
                case 'pubmed':
                    url = `https://pubmed.ncbi.nlm.nih.gov/?term=${encodeURIComponent(query)}`;
                    break;
            }
            if (url) window.open(url, '_blank');
        });

        // Aether Feed
        document.getElementById('feed-avatar').src = userData.avatarUrl;
        const feedPostInput = document.getElementById('feed-post-input');
        const feedPostBtn = document.getElementById('feed-post-btn');
        const feedPostsContainer = document.getElementById('aether-feed-posts');

        function renderFeedPosts() {
            feedPostsContainer.innerHTML = '';
            mockDatabase.get('feedPosts').forEach(post => {
                const postEl = document.createElement('div');
                postEl.className = 'flex items-start gap-3 border-t border-gray-100 pt-4';
                postEl.innerHTML = `
                    <img src="${post.avatarUrl}" class="w-10 h-10 rounded-full">
                    <div class="flex-1">
                        <p class="font-semibold text-sm">${post.fullName} <span class="text-gray-500 font-normal ml-2">${new Date(post.timestamp).toLocaleString()}</span></p>
                        <p class="text-gray-700 mt-1 whitespace-pre-wrap">${post.message}</p>
                    </div>
                `;
                feedPostsContainer.prepend(postEl);
            });
        }

        feedPostBtn.addEventListener('click', () => {
            const message = feedPostInput.value.trim();
            if (!message) return;
            
            const newPost = {
                id: Date.now(),
                fullName: userData.fullName,
                avatarUrl: userData.avatarUrl,
                message: message,
                timestamp: new Date().toISOString()
            };
            const currentPosts = mockDatabase.get('feedPosts');
            currentPosts.push(newPost);
            mockDatabase.set('feedPosts', currentPosts);
            
            if (document.getElementById('feed-notify-email').checked) {
                console.log(`Simulating email notification to ${userData.email} for post: "${message}"`);
                showToast(`Email notification sent for your new post!`);
            }
            
            renderFeedPosts();
            feedPostInput.value = '';
            document.getElementById('feed-notify-email').checked = false;
        });

        // Podcast Hub
        const podcastTabs = document.querySelectorAll('.podcast-tab');
        const rssContent = document.getElementById('podcast-rss-content');
        const uploadsContent = document.getElementById('podcast-uploads-content');
        
        podcastTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                podcastTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                if (tab.dataset.tab === 'rss') {
                    rssContent.style.display = 'block';
                    uploadsContent.style.display = 'none';
                } else {
                    rssContent.style.display = 'none';
                    uploadsContent.style.display = 'block';
                }
            });
        });
        
        document.getElementById('fetchFeed').onclick = () => loadPodcast(document.getElementById('feedUrl').value);
        
        const podcastUploadInput = document.getElementById('podcast-upload-input');
        podcastUploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const episode = {
                    id: Date.now(),
                    name: file.name,
                    url: URL.createObjectURL(file)
                };
                const uploadedEpisodes = mockDatabase.get('uploadedEpisodes');
                uploadedEpisodes.push(episode);
                mockDatabase.set('uploadedEpisodes', uploadedEpisodes);
                renderUploadedEpisodes();
            }
        });

        function renderUploadedEpisodes() {
            const container = document.getElementById('uploaded-episodes');
            container.innerHTML = '';
            const uploadedEpisodes = mockDatabase.get('uploadedEpisodes');
            if (uploadedEpisodes.length === 0) {
                container.innerHTML = `<li class="text-sm text-gray-500 text-center py-4">No uploaded audio files.</li>`;
                return;
            }
            uploadedEpisodes.forEach(ep => {
                const li = document.createElement('li');
                li.className = "border-t border-gray-200 pt-3";
                li.innerHTML = `<p class="font-semibold text-sm mb-2">${ep.name}</p><audio controls class="w-full h-8" src="${ep.url}"></audio>`;
                container.prepend(li);
            });
        }
        
        async function loadPodcast(url) {
            const list = document.getElementById('episodeFeed');
            if (!url) { alert('Please enter a valid RSS feed URL.'); return; }
            list.innerHTML = `<li class="text-sm text-gray-500">Loading feed...</li>`;
            try {
                const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
                if (!res.ok) throw new Error('Failed to fetch feed');
                const data = await res.json();
                
                if (data.status !== 'ok') { list.innerHTML = `<li class="text-sm text-red-500">Error: ${data.message}</li>`; return; }

                list.innerHTML = '';
                data.items.slice(0, 3).forEach(item => {
                    const li = document.createElement('li');
                    li.className = "border-t border-gray-200 pt-3";
                    li.innerHTML = `<p class="font-semibold text-sm mb-2">${item.title}</p><audio controls class="w-full h-8" src="${item.enclosure.link}"></audio>`;
                    list.appendChild(li);
                });
            } catch (err) {
                list.innerHTML = `<li class="text-sm text-red-500">Could not load feed. Check the URL.</li>`;
            }
        }
        
        function loadTimeline() {
             const list = document.getElementById('timelineList');
             list.innerHTML = '';
             const connections = mockDatabase.get('connections');
             if (connections.length === 0) {
                 list.innerHTML = `<li class="text-sm text-gray-500">No connections yet.</li>`;
                 return;
             }
             connections.slice(0, 5).forEach(conn => {
                 const li = document.createElement('li');
                 li.className = "flex items-center";
                 li.innerHTML = `<img src="${conn.avatarUrl||'https://i.pravatar.cc/40'}" class="timeline-avatar"><div class="flex-1"><div class="font-medium text-sm">${conn.name}</div><div class="text-xs text-gray-500">joined ${new Date(conn.connectedAt).toLocaleDateString()}</div></div>`;
                 list.appendChild(li);
             });
        }
        
        loadTimeline();
        renderFeedPosts();
        renderUploadedEpisodes();
    }
    
    function initStrategyPage() {
        // ... (All strategy and Gantt logic as before)
    }
    
    function initCareerMap() {
        // ... (All career map logic as before)
    }
    
    function initLearningHub(userData) {
        // ... (All learning hub logic as before)
    }

    function initCollaborationPage(userData) {
        // ... (All collaboration logic as before)
    }

    function initAdminPage() {
        // ... (All admin logic as before)
    }
    
    function initProfilePage(userData) {
        // ... (All profile logic as before)
    }
    
    // --- AI Search Functionality (Gemini) ---
    async function performProfileSearch(term) {
        // ... (AI Search Modal Logic as before)
    }
    
    async function fetchIdealProfiles(term) {
        // IMPORTANT: Replace "" with your actual Google AI Gemini API key.
        const apiKey = ""; 
        if (!apiKey) { throw new Error("API key is not set."); }
        // ... (Rest of fetch logic as before)
    }
    // ... (renderProfileResults and other helper functions as before)
});
</script>
</body>
</html>
